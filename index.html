<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analogical Scenarios Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&family=Avenir:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #7c3aed;
            --secondary-color: #5b21b6;
            --background-color: #f5f3ff;
            --card-background: #ffffff;
            --text-primary: #1e1b4b;
            --text-secondary: #4c1d95;
            --border-color: #e9d8fd;
            --hover-color: #f3e8ff;
            --shadow-sm: 0 1px 2px 0 rgb(124, 58, 237, 0.05);
            --shadow-md: 0 4px 6px -1px rgb(124, 58, 237, 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Avenir', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: grid;
            grid-template-columns: 300px 300px 300px 1fr;
            height: 100vh;
            overflow: hidden;
            background-color: var(--background-color);
        }

        .column {
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            background-color: var(--card-background);
        }

        .column-header {
            padding: 1rem;
            background-color: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
            letter-spacing: -0.025em;
            font-family: 'Raleway', sans-serif;
        }

        .column-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) var(--background-color);
        }

        .column-content::-webkit-scrollbar {
            width: 6px;
        }

        .column-content::-webkit-scrollbar-track {
            background: var(--background-color);
        }

        .column-content::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 3px;
        }

        .search-container {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--card-background);
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: all 0.2s;
            background-color: var(--background-color);
            font-family: 'Avenir', sans-serif;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .domain-item,
        .category-item,
        .scenario-item {
            padding: 0.875rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .domain-item:hover,
        .category-item:hover,
        .scenario-item:hover {
            background-color: var(--hover-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .domain-item.selected,
        .category-item.selected,
        .scenario-item.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.2);
        }

        .domain-item.selected h3,
        .category-item.selected h3,
        .scenario-item.selected h3 {
            color: white;
        }

        .domain-item.selected p,
        .category-item.selected p,
        .scenario-item.selected p {
            color: rgba(255, 255, 255, 0.9);
        }

        .domain-item h3,
        .category-item h3,
        .scenario-item h3 {
            font-size: 1rem;
            margin-bottom: 0.375rem;
            color: var(--primary-color);
            font-weight: 600;
            letter-spacing: -0.025em;
            font-family: 'Raleway', sans-serif;
        }

        .domain-item p,
        .category-item p,
        .scenario-item p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.5;
        }

        .scenario-details {
            padding: 1rem;
        }

        .scenario-details h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.025em;
            font-family: 'Raleway', sans-serif;
        }

        .scenario-details h3 {
            color: var(--text-primary);
            margin: 0.75rem 0 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.025em;
            font-family: 'Raleway', sans-serif;
        }

        .scenario-details p {
            margin-bottom: 1rem;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .active-ingredients,
        .overall-synthesis {
            background: var(--background-color);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin: 1rem 0;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .active-ingredients ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .active-ingredients li {
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .active-ingredients li:before {
            content: "â€¢";
            color: var(--primary-color);
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .active-ingredients strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        .citation {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.85rem;
            vertical-align: baseline;
            line-height: 1;
            padding: 0.1em 0.3em;
            border-radius: 0.2em;
            transition: all 0.2s;
        }

        .citation:hover {
            background-color: rgba(124, 58, 237, 0.1);
            text-decoration: none;
        }

        .domain-item.selected .citation,
        .category-item.selected .citation,
        .scenario-item.selected .citation {
            color: rgba(255, 255, 255, 0.9);
        }

        .domain-item.selected .citation:hover,
        .category-item.selected .citation:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .active-ingredients {
            background: var(--background-color);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin: 1rem 0;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .ingredients-content {
            white-space: pre-line;
            font-family: inherit;
            line-height: 1.5;
        }

        .ingredients-content strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        @media (max-width: 1400px) {
            .app-container {
                grid-template-columns: 280px 280px 280px 1fr;
            }
        }

        @media (max-width: 1200px) {
            .app-container {
                grid-template-columns: 250px 250px 250px 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="column">
            <div class="column-header">Domains</div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search domains..." id="domainSearch">
            </div>
            <div class="column-content" id="domainsList">
                <!-- Domains will be populated here -->
            </div>
        </div>

        <div class="column">
            <div class="column-header">Categories</div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search categories..." id="categorySearch">
            </div>
            <div class="column-content" id="categoriesList">
                <!-- Categories will be populated here -->
            </div>
        </div>

        <div class="column">
            <div class="column-header">Scenarios</div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search scenarios..." id="scenarioSearch">
            </div>
            <div class="column-content" id="scenariosList">
                <!-- Scenarios will be populated here -->
            </div>
        </div>

        <div class="column">
            <div class="column-header">Scenario Details</div>
            <div class="column-content" id="scenarioDetails">
                <!-- Scenario details will be populated here -->
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        let data = analogicalData;
        let selectedDomain = null;
        let selectedCategory = null;
        let selectedScenario = null;

        // Initialize the interface
        function initialize() {
            filterDomains(''); // This will render all domains initially
            setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('domainSearch').addEventListener('input', (e) => {
                filterDomains(e.target.value);
            });

            document.getElementById('categorySearch').addEventListener('input', (e) => {
                filterCategories(e.target.value);
            });

            document.getElementById('scenarioSearch').addEventListener('input', (e) => {
                filterScenarios(e.target.value);
            });
        }

        // Process text to convert citation numbers into clickable links
        function processCitations(text, sources) {
            if (!text || !sources) return text;
            
            // Replace citation numbers like [1, 2] or [1] with clickable links
            return text.replace(/\[(\d+(?:,\s*\d+)*)\]/g, (match, numbers) => {
                const citationNumbers = numbers.split(',').map(n => n.trim());
                return citationNumbers.map(num => {
                    const source = sources.find(s => s.citation_number === parseInt(num));
                    if (source) {
                        return `<a href="${source.url}" class="citation" target="_blank">[${num}]</a>`;
                    }
                    return `[${num}]`;
                }).join(', ');
            });
        }

        // Filter and render domains
        function filterDomains(searchTerm) {
            const domainsList = document.getElementById('domainsList');
            const filteredDomains = data.domains.filter(domain => 
                domain.domain_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                domain.domain_rationale.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            domainsList.innerHTML = filteredDomains.map(domain => `
                <div class="domain-item ${selectedDomain === domain.domain_name ? 'selected' : ''}" 
                     onclick="selectDomain('${domain.domain_name}')">
                    <h3>${domain.domain_name}</h3>
                    <p>${domain.domain_rationale}</p>
                </div>
            `).join('');
        }

        // Select domain and render categories
        function selectDomain(domainName) {
            selectedDomain = domainName;
            selectedCategory = null;
            selectedScenario = null;
            filterDomains(document.getElementById('domainSearch').value);
            filterCategories('');
            document.getElementById('scenariosList').innerHTML = '';
            document.getElementById('scenarioDetails').innerHTML = '';
        }

        // Filter and render categories
        function filterCategories(searchTerm) {
            if (!selectedDomain) {
                document.getElementById('categoriesList').innerHTML = '';
                return;
            }
            
            const categoriesList = document.getElementById('categoriesList');
            const domain = data.domains.find(d => d.domain_name === selectedDomain);
            const filteredCategories = domain.categories.filter(category =>
                category.category_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                category.category_overview.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            categoriesList.innerHTML = filteredCategories.map(category => `
                <div class="category-item ${selectedCategory === category.category_name ? 'selected' : ''}"
                     onclick="selectCategory('${category.category_name}')">
                    <h3>${category.category_name}</h3>
                    <p>${category.category_overview}</p>
                </div>
            `).join('');
        }

        // Select category and render scenarios
        function selectCategory(categoryName) {
            selectedCategory = categoryName;
            selectedScenario = null;
            filterCategories(document.getElementById('categorySearch').value);
            filterScenarios('');
            document.getElementById('scenarioDetails').innerHTML = '';
        }

        // Filter and render scenarios
        function filterScenarios(searchTerm) {
            if (!selectedDomain || !selectedCategory) {
                document.getElementById('scenariosList').innerHTML = '';
                return;
            }
            
            const scenariosList = document.getElementById('scenariosList');
            const domain = data.domains.find(d => d.domain_name === selectedDomain);
            const category = domain.categories.find(c => c.category_name === selectedCategory);
            const filteredScenarios = category.scenarios.filter(scenario =>
                scenario.scenario_name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            scenariosList.innerHTML = filteredScenarios.map(scenario => `
                <div class="scenario-item ${selectedScenario === scenario.scenario_name ? 'selected' : ''}"
                     onclick="selectScenario('${scenario.scenario_name}')">
                    <h3>${scenario.scenario_name}</h3>
                    <p>${scenario.search_results[0].result.scenario_description}</p>
                </div>
            `).join('');
        }

        // Select scenario and render details
        function selectScenario(scenarioName) {
            selectedScenario = scenarioName;
            filterScenarios(document.getElementById('scenarioSearch').value);
            renderScenarioDetails(selectedDomain, selectedCategory, scenarioName);
        }

        // Render scenario details
        function renderScenarioDetails(domainName, categoryName, scenarioName) {
            const scenarioDetails = document.getElementById('scenarioDetails');
            const domain = data.domains.find(d => d.domain_name === domainName);
            const category = domain.categories.find(c => c.category_name === categoryName);
            const scenario = category.scenarios.find(s => s.scenario_name === scenarioName);
            const result = scenario.search_results[0].result;
            
            // Process active ingredients to handle markdown-style formatting
            const activeIngredients = result.active_ingredients
                .split('\n')
                .map(line => {
                    // Convert markdown bold to HTML strong
                    line = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    // Process citations
                    line = processCitations(line, result.grounded_sources);
                    return line;
                })
                .join('\n');
            
            scenarioDetails.innerHTML = `
                <div class="scenario-details">
                    <h2>${scenario.scenario_name}</h2>
                    <p>${processCitations(result.scenario_description, result.grounded_sources)}</p>
                    
                    <div class="active-ingredients">
                        <h3>Active Ingredients</h3>
                        <div class="ingredients-content">${activeIngredients}</div>
                    </div>
                    
                    <div class="overall-synthesis">
                        <h3>Overall Synthesis</h3>
                        <p>${processCitations(result.overall_synthesis, result.grounded_sources)}</p>
                    </div>
                </div>
            `;
        }

        // Initialize
        initialize();
    </script>
</body>
</html> 